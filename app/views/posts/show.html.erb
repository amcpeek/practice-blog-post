<div class="max-w-4xl mx-auto">
  <!-- Post Content -->
  <article class="bg-white rounded-lg shadow-md p-8 mb-8">
    <div class="mb-6">
      <h1 class="text-4xl font-bold text-gray-800 mb-4">
        <%= @post.title %>
        <% unless @post.published? %>
          <span class="text-base bg-yellow-100 text-yellow-800 px-3 py-1 rounded">Draft</span>
        <% end %>
      </h1>

      <div class="text-gray-600 mb-4">
        By <%= @post.author.full_name %>
        •
        <%= @post.published? ? @post.published_at.strftime("%B %d, %Y at %l:%M %p") : "Unpublished" %>
      </div>

      <% if logged_in? && @post.author == current_user %>
        <div class="flex space-x-3 mb-4">
          <%= link_to "Edit Post", edit_post_path(@post), class: "bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" %>
          <%= button_to "Delete Post", post_path(@post), method: :delete,
              data: { turbo_confirm: "Are you sure you want to delete this post?" },
              class: "bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700" %>
        </div>
      <% end %>
    </div>

    <div class="prose max-w-none text-gray-700 whitespace-pre-wrap">
      <%= @post.body %>
    </div>
  </article>

  <!-- Comments Section -->
  <div class="bg-white rounded-lg shadow-md p-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">
      Comments (<%= @post.comments.count %>)
    </h2>

    <!-- Comment Form (only if logged in) -->
    <% if logged_in? %>
      <div class="mb-8 bg-gray-50 p-4 rounded-lg">
        <%= form_with model: [ @post, Comment.new ], class: "space-y-4" do |f| %>
          <div>
            <%= f.label :body, "Add a comment", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.text_area :body,
                rows: 3,
                placeholder: "Share your thoughts...",
                required: true,
                class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>
          <%= f.submit "Post Comment", class: "bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700" %>
        <% end %>
      </div>
    <% else %>
      <div class="mb-8 bg-blue-50 border border-blue-200 p-4 rounded-lg">
        <p class="text-blue-800">
          <%= link_to "Login", login_path, class: "font-semibold underline" %> to leave a comment.
        </p>
      </div>
    <% end %>

    <!-- Comments List -->
    <% if @post.comments.any? %>
      <div class="space-y-4">
        <% @post.comments.order(created_at: :desc).each do |comment| %>
          <div class="border-l-4 border-blue-500 pl-4 py-2">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="text-sm text-gray-600 mb-2">
                  <span class="font-semibold text-gray-800"><%= comment.author.full_name %></span>
                  •
                  <%= time_ago_in_words(comment.created_at) %> ago
                </div>
                <p class="text-gray-700"><%= comment.body %></p>
              </div>

              <% if logged_in? && comment.author == current_user %>
                <div class="ml-4">
                  <%= button_to "Delete", post_comment_path(@post, comment), method: :delete,
                      data: { turbo_confirm: "Are you sure?" },
                      class: "text-red-600 hover:text-red-800 text-sm" %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-gray-500 italic">No comments yet. Be the first to comment!</p>
    <% end %>
  </div>

  <!-- Back Link -->
  <div class="mt-6">
    <%= link_to "← Back to all posts", root_path, class: "text-blue-600 hover:text-blue-800" %>
  </div>
</div>
